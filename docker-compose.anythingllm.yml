version: '3.8'

services:
  anythingllm:
    image: mintplexlabs/anythingllm:latest
    container_name: anythingllm-local
    ports:
      - "3102:3001"  # External port 3102, internal container port 3001
    environment:
      # LLM Provider
      LLM_PROVIDER: groq
      GROQ_API_KEY: ${GROQ_API_KEY}

      # Authentication
      AUTH_TOKEN: ${ANYTHINGLLM_AUTH_TOKEN:-dev_token_change_in_production}
      JWT_SECRET: ${ANYTHINGLLM_JWT_SECRET:-dev_jwt_secret_change_in_production}

      # Storage
      STORAGE_DIR: /app/server/storage

      # Server
      SERVER_PORT: 3001
      NODE_ENV: development

      # Embeddings (using native for local dev)
      EMBEDDING_PROVIDER: native
      VECTOR_DB: lancedb

      # Disable telemetry for privacy
      DISABLE_TELEMETRY: true
    volumes:
      # Persist data locally
      - ./anythingllm-storage:/app/server/storage
      # Mount knowledge base for easy access
      - ./knowledge-base:/knowledge-base:ro
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3001/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

volumes:
  anythingllm-storage:
    driver: local
